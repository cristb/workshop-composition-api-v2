<!DOCTYPE html>
<html lang="en">
  <body>
    <div id="app">
      <div v-if="loading">loading...</div>
      <div v-else>
          <h1>Products ({{numberOfProducts}})</h1>
          <ul>
              <li v-for="product in products" :key="product.id" >{{ product.title }}</li>
          </ul>
      </div>
    </div>
    <script type="module">
      import {
        createApp,
        computed,
        ref,
        // onMounted,
      } from "https://unpkg.com/vue@3/dist/vue.esm-browser.js";
      const App = {
        setup() {
          const loading = ref(false);
          const products = ref([]);

          const numberOfProducts = computed(() => products.value.length);

          async function fetchProducts() {
            const res = await fetch(
              "https://dummyjson.com/products?limit=10000"
            );
            const data = await res.json();
            products.value = data.products;
          };

          // onMounted(async () => {
          //   loading.value = true;
          //   await fetchProducts();
          //   loading.value = false;
          // });

          // faster because it's not waiting for mouting the component
          loading.value = true;
          fetchProducts().then(() => {
            loading.value = false;
          });

          return { loading, products, numberOfProducts, fetchProducts };
        },
      };

      createApp(App).mount("#app");
    </script>
  </body>
</html>
